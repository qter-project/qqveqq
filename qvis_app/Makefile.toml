[env]
LEPTOS_TAILWIND_VERSION="v4.1.18"
LEPTOS_WASM_OPT_VERSION="version_125"

[tasks.dev-mac]
run_task = { name = ["dev-server-mac", "dev-caddy"], parallel = true }

[tasks.dev-server-mac]
command = "cargo"
args = ["leptos", "watch"]

[tasks.dev-server-mac.env]
DYLD_FALLBACK_LIBRARY_PATH="/usr/local/lib:/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/"
LDFLAGS="-L/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib"
LD_LIBRARY_PATH="/usr/local/lib"

[tasks.dev-caddy]
dependencies = ["kill-caddy"]
command = "caddy"
args = ["reverse-proxy", "--to", ":3000"]

[tasks.prod]
run_task = { name = ["prod-server", "prod-caddy"], parallel = true }

[tasks.prod-server]
command = "cargo"
args = ["leptos", "serve"]

[tasks.prod-caddy]
dependencies = ["kill-caddy"]
command = "caddy"
args = ["reverse-proxy", "--from", "10.42.0.1", "--to", ":3000"]

[tasks.kill-caddy]
command = "pkill"
args = ["caddy"]

[config]
unstable_features = ["CTRL_C_HANDLING"]
